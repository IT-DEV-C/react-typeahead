!function(e,t){"use strict";var n=n||{};n.DOM_VK_UP=n.DOM_VK_UP||38,n.DOM_VK_DOWN=n.DOM_VK_DOWN||40,n.DOM_VK_BACK_SPACE=n.DOM_VK_BACK_SPACE||8,n.DOM_VK_RETURN=n.DOM_VK_RETURN||13,n.DOM_VK_ENTER=n.DOM_VK_ENTER||14,n.DOM_VK_ESCAPE=n.DOM_VK_ESCAPE||27,e.KeyEvent=n;{var n=t,s=React.createClass({displayName:"Typeahead",propTypes:{options:React.PropTypes.array,defaultValue:React.PropTypes.string,onOptionSelected:React.PropTypes.func,onKeyDown:React.PropTypes.func},getDefaultProps:function(){return{options:[],defaultValue:"",onKeyDown:function(){return!0},onOptionSelected:function(){}}},getInitialState:function(){var e=this.props.options.slice();return e.sort(function(e,t){return e.length-t.length}),{options:e,visible:this.getOptionsForValue(this.props.defaultValue,this.props.options),entryValue:this.props.defaultValue,selection:null}},getOptionsForValue:function(e,t){var n=t.filter(function(t){return-1!=t.indexOf(e)}.bind(this));return n},setEntryText:function(e){this.refs.entry.getDOMNode().value=e,this._onTextEntryUpdated()},_renderIncrementalSearchResults:function(){return this.state.entryValue?this.state.selection?"":this.state.visible.length?o({ref:"sel",options:this.state.visible,onOptionSelected:this._onOptionSelected}):"":""},_onOptionSelected:function(e){var t=this.refs.entry.getDOMNode();t.focus(),t.value=e,this.setState({visible:this.getOptionsForValue(e,this.state.options),selection:e,entryValue:e}),this.props.onOptionSelected(e)},_onTextEntryUpdated:function(){var e=this.refs.entry.getDOMNode().value;return this.setState({visible:this.getOptionsForValue(e,this.state.options),selection:null,entryValue:e}),!1},_onKeyDown:function(e){if(!this.refs.sel)return this.props.onKeyDown(e);if(e.keyCode==n.DOM_VK_UP)this.refs.sel.navUp();else if(e.keyCode==n.DOM_VK_DOWN)this.refs.sel.navDown();else if(e.keyCode==n.DOM_VK_RETURN||e.keyCode==n.DOM_VK_ENTER){if(!this.refs.sel.state.selection)return this.props.onKeyDown(e);this._onOptionSelected(this.refs.sel.state.selection)}else{if(e.keyCode!=n.DOM_VK_ESCAPE)return this.props.onKeyDown(e);this.refs.sel.setSelectionIndex(null)}return!1},render:function(){return React.DOM.div({"class":"typeahead"},React.DOM.input({ref:"entry",type:"text",defaultValue:this.state.entryValue,onChange:this._onTextEntryUpdated,onKeyDown:this._onKeyDown}),this._renderIncrementalSearchResults())}}),o=React.createClass({displayName:"TypeaheadSelector",propTypes:{options:React.PropTypes.array,selectionIndex:React.PropTypes.number,onOptionSelected:React.PropTypes.func},getDefaultProps:function(){return{selectionIndex:null,onOptionSelected:function(){}}},getInitialState:function(){return{selectionIndex:this.props.selectionIndex,selection:this.getSelectionForIndex(this.props.selectionIndex)}},render:function(){var e=this.props.options.map(function(e,t){return i({ref:e,key:e,hover:this.state.selectionIndex===t,onClick:function(){return this.props.onOptionSelected(e),!1}.bind(this)},e)},this);return React.DOM.div({"class":"typeahead-selector"},e)},setSelectionIndex:function(e){this.setState({selectionIndex:e,selection:this.getSelectionForIndex(e)})},getSelectionForIndex:function(e){return null===e?null:this.props.options[e]},_nav:function(e){if(this.props.options){var t;t=null===this.state.selectionIndex?1==e?0:e:this.state.selectionIndex+e,0>t?t+=this.props.options.length:t>=this.props.options.length&&(t-=this.props.options.length);var n=this.getSelectionForIndex(t);this.setState({selectionIndex:t,selection:n})}},navDown:function(){this._nav(1)},navUp:function(){this._nav(-1)}}),i=React.createClass({displayName:"TypeaheadOption",propTypes:{onClick:React.PropTypes.func,children:React.PropTypes.string},getDefaultProps:function(){return{onClick:function(){return!1}}},getInitialState:function(){return{hover:!1}},render:function(){return React.DOM.div(null,React.DOM.a({href:"#","class":this._getClasses(),onClick:this._onClick},this.props.children))},_getClasses:function(){var e="typeahead-option";return this.props.hover&&(e+=" hover"),e},_onClick:function(){return this.props.onClick()}}),r=React.createClass({displayName:"Token",propTypes:{children:React.PropTypes.string,onRemove:React.PropTypes.func},render:function(){return React.DOM.div({"class":"typeahead-token"},this.props.children,this._makeCloseButton())},_makeCloseButton:function(){return this.props.onRemove?React.DOM.a({"class":"typeahead-token-close",href:"#",onClick:function(){return this.props.onRemove(this.props.children),!1}.bind(this)},"Ã—"):""}});React.createClass({displayName:"TypeaheadTokenizer",propTypes:{options:React.PropTypes.array,defaultSelected:React.PropTypes.array,defaultValue:React.PropTypes.string},getInitialState:function(){return{selected:this.props.defaultSelected}},getDefaultProps:function(){return{options:[],defaultSelected:[],defaultValue:""}},_renderTokens:function(){var e=this.state.selected.map(function(e){return r({key:e,onRemove:this._removeTokenForValue},e)},this);return e},_getOptionsForTypeahead:function(){return this.props.options},_onKeyDown:function(e){if(e.keyCode!==n.DOM_VK_BACK_SPACE)return!0;if(!this.state.selected.length)return!0;var t=this.refs.typeahead.refs.entry.getDOMNode();return t.selectionStart==t.selectionEnd&&0==t.selectionStart?(this._removeTokenForValue(this.state.selected[this.state.selected.length-1]),!1):!0},_removeTokenForValue:function(e){var t=this.state.selected.indexOf(e);return-1==t?!1:(this.state.selected.splice(t,1),this.setState({selected:this.state.selected}),!1)},_addTokenForValue:function(e){-1==this.state.selected.indexOf(e)&&(this.state.selected.push(e),this.setState({selected:this.state.selected}),this.refs.typeahead.setEntryText(""))},render:function(){return React.DOM.div(null,this._renderTokens(),s({ref:"typeahead",options:this._getOptionsForTypeahead(),defaultValue:this.props.defaultValue,onOptionSelected:this._addTokenForValue,onKeyDown:this._onKeyDown}))}})}e.Typeahead=s}(window,window.KeyEvent);